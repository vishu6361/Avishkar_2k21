<html>

<head>
    <meta charset="UTF-8">
    <title>Register</title>
    <meta name="description" content="Login - Register Template">
    <meta name="author" content="Lorenzo Angelino aka MrLolok">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">


    <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous">
    </script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
  integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  
  
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="../css/elements.css" rel="stylesheet">
    
    <link rel="stylesheet" href="register.css">
	  <link rel="stylesheet" type="text/css" href="../css/navbar/navbar.css">

    <link href='https://fonts.googleapis.com/css?family=Allerta Stencil' rel='stylesheet'>
    <link rel="stylesheet" href="../css/register-login.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-161923538-7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161923538-7');
</script>

    <style>
        body {
            background-color: #303641;
        }
    </style>
    <script>
      if(localStorage.getItem("authtoken")) {
      var myHeaders = new Headers();
      myHeaders.append(
        "Authorization",
        "Token " + localStorage.getItem("authtoken")
		  );

      var formdata = new FormData();

      var requestOptions = {
        method: "POST",
        headers: myHeaders,
        body: formdata,
        redirect: "follow",
      };

      fetch(
          "https://api.divyansh.rocks/auth/getuserdetails/",
        requestOptions
      )
        .then((response) => response.text())
        .then((result) => {
          var userDetails = JSON.parse(result);
          if (!userDetails["success"]) throw result;
          window.location = "../index.html";
        })
        .catch((error) => {
          console.log(error);
        });
    }
    </script>
</head>

<body>

    
	<nav class="navbar navbar-expand-md navbar-dark">
		<!--class navbar-expand-md-->
		<div class="container-fluid">
		  <a class="navbar-brand pt-0 pb-0" href="../index.html">
			<img class="navbar-items-logo" src="../img/Neon_triangle.png" height="80" alt="">
		  </a>
	
		  <button class="navbar-toggler ml-auto pt-0 pb-0" type="button" data-toggle="collapse"
			data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
			aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		  </button>
	
		  <div class="collapse navbar-collapse pt-0 pb-0" id="navbarSupportedContent">
			  <ul class="navbar-nav ml-auto style">
				<li class="nav-item">
				  <a class="nav-link font-weight-bold" href="../events/">EVENTS</a>
				</li>
				<li class="nav-item">
				  <a class="nav-link font-weight-bold" href="../schedule/">SCHEDULE</a>
				</li>
				<li class="nav-item">
				  <a class="nav-link font-weight-bold" href="../sponsors/">SPONSORS</a>
				</li>
				<li class="nav-item">
				  <a class="nav-link font-weight-bold" href="../team/">TEAM</a>
				</li>
				<li class="nav-item">
				  <a class="nav-link font-weight-bold" id="faq-link" href="../faq/">FAQ</a>
				</li>
			  </ul>
			
			<!--login div container-->
			<div id="login">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item dropdown">
						<a class="nav-link" href="#" id="navbarDropdown" role="button" onclick="showPendingRequests()"
							data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="margin-right:12px">
							<img class="navbar-items-logo" src="../img/notification.svg"><span class="badge badge-warning" id="notificationCount"></span></a>
						</a>
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown" id="pendingRequests" style="display: none;">
						</div>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link" href="#" id="navbarDropdown" role="button"
							data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<img class="navbar-items-logo" src="../img/person.svg">
						</a>
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown" style="background-color: black;">
							<a class="dropdown-item" href="../profile/index.html" style = "color:#00E3EF;">Profile</a>
							<div class="dropdown-divider"></div>
							<a class="dropdown-item" href="../create team/createteam.html" style = "color:#00E3EF;">Manage Teams</a>
							<div class="dropdown-divider"></div>
							<a class="dropdown-item" href="#" onclick="logout()" style = "color:#00E3EF;">Logout</a>
						</div>
					</li>
				</ul>
			</div>
	
			<div id="notlogin" style="display: none;">
			  <ul class="navbar-nav ml-auto style">
				<li class="nav-item">
				  <a class="nav-link font-weight-bold" href="../register/login.html">Login</a>
				</li>
			  </ul>
			</div>
		  </div>
		</div>
	  </nav>
		
	
	<!-- Modal -->
	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
		  <div class="modal-content">
			<div class="modal-header">
			  <h5 class="modal-title" id="exampleModalLabel" style="color:black">Confirmation</h5>
			  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			  </button>
			</div>
			<div class="modal-body">
				<div>
			  		<h5 style="color:black"><small>Do you want to accept or reject the request?</small></h5>
				</div>
			</div>
			<div class="modal-footer">
			  <button type="button" class="btn btn-success" onclick="acceptRequest()">Accept</button>
			  <button type="button" class="btn btn-primary" onclick="rejectRequest()">Reject</button>
			</div>
		  </div>
		</div>
	  </div>


    <div class="container mb-5">
      <div class="rows d-flex justify-content-between">
        <div class="col-sm-4 d-flex align-items-center" style="background: none;" id="register-img">
          <img src="../img/imageedit_1_6984842575.png" class="img-thumbnail" alt="Failed to Load Image" style="background: none;border: 0px;display:block;">
        </div>
        <div class="col-sm-4">
          <div id="container-register" style="top:6%">
            <div id="title">
                <i class="material-icons lock"> lock </i> Register
            </div>
    
            <form id="register-form">
                <div class="remember-me">
                    <span style="color: #DDD">MNNIT students should use thier College Email IDs</span>
                </div>

                <div class="input">
                    <div class="input-addon">
                        <i class="material-icons">email</i>
                    </div>
                    <input id="email" placeholder="Email" type="email" required class="validate" autocomplete="off">
                </div>
    
                <div class="clearfix"></div>
    
                <div class="input">
                    <div class="input-addon">
                        <i class="material-icons">face</i>
                    </div>
                    <input id="username" placeholder="Username" type="text" required class="validate" autocomplete="off" pattern="[a-z][a-z0-9_]{1,14}" title="Username length should be between 2 to 15. It should start with small english alphabets(a-z), followed by characters : small english alphabets(a-z), numbers(0-9), and _ (Underscore)">
                </div>
    
                <div class="clearfix"></div>
    
                <div class="input">
                    <div class="input-addon">
                        <i class="material-icons">vpn_key</i>
                    </div>
                    <input id="password" placeholder="Password" type="password" required class="validate" autocomplete="off"pattern=".{7,}" title="Minimum password length should be 7 characters long">
                    <span class="register-eye" onclick="myFunction()">
                        <i id="hide1" class="fa fa-eye"></i>
                        <i id="hide2" class="fa fa-eye-slash"></i>
                    </span>
                </div>


                <!-- <div class="remember-me">
                    <input type="checkbox">
                    <span style="color: #DDD">Are you from MNNIT</span>
                </div> -->
    
                <input type="submit" value="Register" />
            </form>
    
            <div class="privacy">
                <!-- <a href="#">Privacy Policy</a> -->
            </div>
    
            <div class="register">
                Do you already have an account?
                <a href="login.html"><button id="register-link">Log In here</button></a>
            </div>
        </div>
        </div>
      </div>
    </div>
    
    <!--Instruction Modal -->
    <div class="modal fade" id="instructionModal" tabindex="-1" role="dialog" aria-labelledby="instructionModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document" style=" width:100%;max-width:1000px;">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="instructionModalLabel">Instructions to participate in Techfest Avishkar:</h4>
          </div>
          <div class="modal-body" id="instructions-for-registration">
            <div id="instructions-for-registration-for-mnnit">
                <ol>
                    Regarding the <strong>Email verification of MNNIT students</strong>
                    <li> You must go to your registered email addresses and click the verification link</li>
                    <li> In case you face problems logging into your college G-suite ID for email verification,
                        use any other email address and contact the Festival Secretaries for your registration fee. </li>
                </ol>
                After verification is completed<br>
            </div>
            <ol>
              <li>Go to your profile section.</li>
              <li>Complete all the details (about and contact) and keep saving your changes in <b>each section</b>.</li>
              <li>After completing all the sections <b>lock your profile</b>.</li>
            <ol>
            <p>
              <br>
              Above are the one time steps.
              <br><br>
              Now once all your team members have registered themselves and locked their profile, the team leader can create a new team under the Manage teams section and add other members using their usernames.
              <br><br>
              You can create as many teams as you want for different events. Even if you wish to register as a lone wolf then also you need to 
              <b>create a team with no additional members</b>. For events having <b>individual participation</b> also you need <b>a team with you as the only member</b>.
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="proceedBtn">Proceed</button>
          </div>
        </div>
      </div>
    </div>
    <!--Non-mnnit modal-->
    <div class="modal fade" id="nonMnnitModal" tabindex="-1" role="dialog" aria-labelledby="nonMnnitModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document" style=" width:100%;max-width:1000px;">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="nonMnnitModalLabel">Instructions to participate in Techfest Avishkar:</h4>
          </div>
            <div class="modal-body">
                <p>Congratulations for registering for Avishkar 2021.<br>
                    First, you need to <strong>verify your email address</strong> by clicking the link sent to you on your registered email address<br><br>

                    To continue your registration for the events, you are requested to drop a mail to avishkar@mnnit.ac.in
                    requesting the payment link for participation. As mentioned in the FAQs, the registration fee for the events are
                    as follows:-
                </p>
                <ol>
                    <li>For all events of Avishkar - Rs. 250</li>
                    <li>For Gnosiomania quizzes - Rs. 100</li>
                    <li>For Gnotalks and Gnosiomania - Rs. 100</li>
                </ol>
                <p>
                    The above three categories are independent of each other and in order to register for multiple categories, you
                    are requested to add up the amount and pay the respective added fee.
                    <br>
                    As stated earlier, dropping the mail is necessary failing which you won't be able to register for the events and
                    will be debarred in further rounds.
                    <br>
                    After receiving the mail, pay the fee within 72 hours and send the payment receipt in response to the payment
                    link mail.
                    <br>
                    Thank you for your cooperation. Keep Innovating.
                </p>
            </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="nonMnnitproceedBtn">Proceed</button>
          </div>
        </div>
      </div>
    </div>
    <div id="BG"></div>


    <script src="../js/three.js"></script>
  <script src="../js/bg.js"></script>
  <script>
    VANTA.RINGS({
      el: "#BG",
      mouseControls: true,
      touchControls: true,
      gyroControls: false,
      minHeight: 200.00,
      minWidth: 200.00,
      scale: 1.00,
      scaleMobile: 1.00
    })
  </script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous">
    </script>

    <script>

        $(document).ready(function () {
          $('#proceedBtn').click(function(){
              window.location = "../profile/index.html";
          })
          $('#nonMnnitModal').click(function(){
            $('#nonMnnitModal').modal('hide');
            $('#instructionModal').modal({
                        backdrop: 'static',
                        keyboard: false
                    })
          })       
        })

        function myFunction() {
            var x = document.getElementById('password');
            var y = document.getElementById('hide1');
            var z = document.getElementById('hide2');

            if(x.type === 'password') {
                x.type = 'text';
                y.style.display = 'block';
                z.style.display = 'none';
            } else {
                x.type = 'password';
                y.style.display = 'none';
                z.style.display = 'block';
            }
        }
        const myForm = document.getElementById('register-form');
        myForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            toastr.warning('Waiting for response!  .....  ','',{ timeOut: 0, extendedTimeOut: 0 });
            let formdata = new FormData();
            let Email = document.getElementById("register-form").elements[0].value;
            let userName = document.getElementById("register-form").elements[1].value;
            let password = document.getElementById("register-form").elements[2].value;
            // let is_mnnit = document.getElementById("register-form").elements[3];


            // checking whether the student is from MNNIT
            let domain = Email.substring(Email.lastIndexOf("@") + 1);
            let is_mnnit = domain == "mnnit.ac.in" ? "true" : "false";

            // if(is_mnnit.checked === true) {
            //     is_mnnit = "true";
            // } else {
            //     is_mnnit = "false";
            // }

            
            // Displaying additional information for MNNIT students
            if(domain != "mnnit.ac.in") {
                $("#instructions-for-registration-for-mnnit").css("display","none");
            }
            
            formdata.append("username", userName);
            formdata.append("email", Email);
            formdata.append("password", password);
            formdata.append("ismnnit", is_mnnit);

            var requestOptions = {
            method: 'POST',
            body: formdata,
            redirect: 'follow'
            };
            await fetch("https://api.divyansh.rocks/auth/register/", requestOptions)
            .then((response) => {
                return response.text();
            })
            .then((result) => {
                let res = JSON.parse(result);
                console.log(res);
                if(res.success) {
                  console.log(res.token);
                  localStorage.setItem("authtoken", res.token);
                  toastr.remove();
                  if(is_mnnit === 'false'){
                    $('#nonMnnitModal').modal({
                        backdrop: 'static',
                        keyboard: false
                    })
                  }
                  else{
                    $('#instructionModal').modal({
                        backdrop: 'static',
                        keyboard: false
                    })
                  }
                    //window.location = "./login.html";
                    // bs4pop.alert("Registered successful", function (e) {
                    //     window.location = "../events/";
                    // });
                } else {
                    // bs4pop.alert(res.errors + "", function (e) {
                    //     console.log(res.errors);
                    // });
                    console.log(res.errors);
                    toastr.remove();
                    toastr.error(res.errors,'Error!', {
                      closeButton: true
                    });
                }
            })
            .catch((error) => {
                      // bs4pop.alert("" + error, function (e) {
                      //         console.log('error : ', error);
                      //     });
                      console.log(error);
                      toastr.remove();
                    toastr.error('Failed to register','Error!', {
                      closeButton: true
                    });
            });
        });
    </script>
    <script src="../js/navbar/main.js"></script>
    <div class="footer d-flex align-items-center justify-content-center">
		<p class="footer_text" style="margin-bottom: 0">All Rights Reserved &copy; MNNIT Allahabad, 2020</p>
	</div>
</body>

</html>
